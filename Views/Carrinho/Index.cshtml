@model List<Ecommerce.Models.CartItem>
@{
    ViewData["Title"] = "Carrinho";
    var total = (decimal)(ViewBag.Total ?? 0m);
}
<h2>Carrinho</h2>

@if (!Model.Any())
{
    <p>Seu carrinho está vazio.</p>
    <a class="btn btn-primary" asp-controller="Home" asp-action="Index">Ver produtos</a>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>Produto</th>
                <th>Preço</th>
                <th>Qtd</th>
                <th>Subtotal</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
        @foreach (var i in Model)
        {
            <tr>
                <td>
                    <div style="display:flex; gap:12px; align-items:center;">                        
                        @if (!string.IsNullOrWhiteSpace(i.ImagemUrl))
                        {
                            <img src="@i.ImagemUrl" alt="@i.NomeProduto" style="width:48px;height:48px;object-fit:cover;border-radius:6px;" />
                        }
                        <span>@i.NomeProduto</span>
                    </div>
                </td>
                <td>R$ @i.PrecoUnitario.ToString("0.00")</td>
                <td>@i.Quantidade</td>
                <td>R$ @i.Subtotal.ToString("0.00")</td>
                <td>
                    <a class="btn btn-sm btn-outline-secondary"
                       asp-action="Update" asp-route-id="@i.IdProduto">Editar</a>
                    <a class="btn btn-sm btn-outline-danger"
                       asp-action="Delete" asp-route-id="@i.IdProduto">Remover</a>
                </td>
            </tr>
        }
        </tbody>
        <tfoot>
            <tr>
                <th colspan="3" class="text-end">Total</th>
                <th colspan="2">R$ @total.ToString("0.00")</th>
            </tr>
        </tfoot>
    </table>

    @if (Model.Any())
{
    <form asp-controller="Pedido" asp-action="Create" method="get">
        <button class="btn btn-success btn-lg">Finalizar pedido</button>
    </form>
}

    <form asp-action="Limpar" method="post">
        <button class="btn btn-warning">Limpar carrinho</button>
    </form>
}
