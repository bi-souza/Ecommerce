@model List<Ecommerce.Models.CartItem>
@{
    ViewData["Title"] = "Carrinho";
    var total = (decimal)(ViewBag.Total ?? 0m);
}
<br>
<h2>Carrinho</h2>

@if (!Model.Any())
{
    <p>Seu carrinho está vazio.</p>
    <a class="btn btn-primary" asp-controller="Home" asp-action="Index">Ver produtos</a>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>Produto</th>
                <th>Preço</th>
                <th>Qtd</th>
                <th>Subtotal</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
        @foreach (var i in Model)
        {
            <tr>
                <td>
                    <div style="display:flex; gap:12px; align-items:center;">                        
                        @if (!string.IsNullOrWhiteSpace(i.ImagemUrl))
                        {
                            <img src="@i.ImagemUrl" alt="@i.NomeProduto" style="width:48px;height:48px;object-fit:cover;border-radius:6px;" />
                        }
                        <span>@i.NomeProduto</span>
                    </div>
                </td>
                <td>R$ @i.PrecoUnitario.ToString("0.00")</td>
                <td>@i.Quantidade</td>
                <td>R$ @i.Subtotal.ToString("0.00")</td>
                <td>
                    <a class="btn btn-sm btn-outline-secondary"
                       asp-action="Update" asp-route-id="@i.IdProduto">Editar</a>
                    <a class="btn btn-sm btn-outline-danger"
                       asp-action="Delete" asp-route-id="@i.IdProduto">Remover</a>
                </td>
            </tr>
        }
        </tbody>
        <tfoot>
            <tr>
                <th colspan="3" class="text-end">Total</th>
                <th colspan="2">R$ @total.ToString("0.00")</th>
            </tr>
        </tfoot>
    </table>

    <form asp-controller="Pedido" asp-action="Create" method="get">
        <button class="btn btn-success btn-lg">Finalizar pedido</button>
    </form>

}

<div class="modal fade" id="alertaAdminModal" tabindex="-1" aria-labelledby="alertaAdminModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="alertaAdminModalLabel">Ação Não Autorizada</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="modal-body-content">
      </div>
      <div class="modal-footer">
        <a href="/Auth/Logout" class="btn btn-danger">Fazer Logout</a>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
      </div>
    </div>
  </div>
</div>

@if (TempData["ModalMsg"] != null)
{
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Obtém o valor do TempData
            var message = @Html.Raw(Json.Serialize(TempData["ModalMsg"])); 
            
            // Coloca a mensagem no corpo do modal
            document.getElementById('modal-body-content').innerHTML = message;

            // Instancia e mostra o modal (usando Bootstrap 5)
            var adminModal = new bootstrap.Modal(document.getElementById('alertaAdminModal'));
            adminModal.show();
        });
    </script>
}
